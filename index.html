<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');

        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1A2980, #26D0CE);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        h1 { margin: 0; font-weight: 600; font-size: 1.8rem; }
        
        /* Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î */
        .city-selector {
            margin: 15px 0;
        }
        select {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Sarabun';
            font-size: 1rem;
            color: #333;
            cursor: pointer;
        }

        .clock {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .date-display { font-size: 1rem; margin-bottom: 20px; opacity: 0.9; }

        .prayer-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
        }

        .prayer-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
        }

        .prayer-item:last-child { border-bottom: none; }
        
        /* Highlight ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ */
        .prayer-item.active {
            background: rgba(255, 215, 0, 0.9);
            color: #333;
            font-weight: bold;
        }

        .next-prayer-info {
            margin-top: 20px;
            font-size: 1rem;
            color: #ffeb3b;
            font-weight: bold;
            min-height: 24px;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á */
        .enable-sound-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            margin-bottom: 20px;
            font-family: 'Sarabun', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
            transition: transform 0.2s;
        }
        .enable-sound-btn:hover { transform: scale(1.05); }
        .enable-sound-btn.hidden { display: none; }

        footer { margin-top: 20px; font-size: 0.8rem; opacity: 0.6; }
    </style>
</head>
<body>

<div class="container">
    <button id="enableSound" class="enable-sound-btn">
        <i class="fas fa-volume-up"></i> ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    </button>

    <h1>‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏î</h1>
    
    <div class="city-selector">
        <select id="citySelect">
            <option value="Yala">‡∏¢‡∏∞‡∏•‡∏≤ (Yala)</option>
            <option value="Pattani">‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ (Pattani)</option>
            <option value="Narathiwat">‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™ (Narathiwat)</option>
            <option value="Songkhla">‡∏™‡∏á‡∏Ç‡∏•‡∏≤ (Songkhla)</option>
            <option value="Satun">‡∏™‡∏ï‡∏π‡∏• (Satun)</option>
            <option value="Bangkok">‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø (Bangkok)</option>
            <option value="Chiang Mai">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà (Chiang Mai)</option>
            <option value="Phuket">‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Phuket)</option>
        </select>
    </div>

    <div class="clock" id="clock">00:00:00</div>
    <div class="date-display" id="dateDisplay">-</div>

    <div id="prayerContainer" class="prayer-list">
        <p style="padding:20px">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <div class="next-prayer-info" id="statusMsg"></div>

    <footer>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Aladhan API</footer>

    <audio id="adhanAudio">
        <source src="adhan.mp3" type="audio/mpeg">
    </audio>
</div>

<script>
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    const country = "Thailand";
    let currentCity = localStorage.getItem('selectedCity') || "Yala"; // ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ UI ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏ß‡πâ
    document.getElementById('citySelect').value = currentCity;

    const prayerNamesTh = {
        "Fajr": "‡∏ã‡∏∏‡∏ö‡∏Æ‡∏¥",
        "Dhuhr": "‡∏î‡∏∏‡∏Æ‡∏£‡∏¥",
        "Asr": "‡∏≠‡∏±‡∏™‡∏£‡∏¥",
        "Maghrib": "‡∏°‡∏±‡∏Ü‡∏£‡∏¥‡∏ö",
        "Isha": "‡∏≠‡∏¥‡∏ä‡∏≤"
    };

    let prayerTimes = {};
    let audioEnabled = false;
    let adhanPlayedThisMinute = false;
    
    const audio = document.getElementById('adhanAudio');
    const btnEnable = document.getElementById('enableSound');
    const statusMsg = document.getElementById('statusMsg');

    // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Browser Policy)
    btnEnable.addEventListener('click', () => {
        audio.play().then(() => {
            audio.pause();
            audio.currentTime = 0;
            audioEnabled = true;
            btnEnable.classList.add('hidden');
            statusMsg.innerText = "üîä ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
            setTimeout(() => statusMsg.innerText = "", 3000);
        }).catch(err => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ: " + err));
    });

    // 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
    document.getElementById('citySelect').addEventListener('change', (e) => {
        currentCity = e.target.value;
        localStorage.setItem('selectedCity', currentCity); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤
        fetchPrayerTimes();
        statusMsg.innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î " + currentCity;
        setTimeout(() => statusMsg.innerText = "", 2000);
    });

    // 3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API
    async function fetchPrayerTimes() {
        const apiUrl = `https://api.aladhan.com/v1/timingsByCity?city=${currentCity}&country=${country}&method=8`;
        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            if(data.code === 200) {
                renderPrayerList(data.data.timings);
                prayerTimes = data.data.timings;
                document.getElementById('dateDisplay').innerText = data.data.date.readable;
            }
        } catch (error) {
            console.error("API Error:", error);
            document.getElementById('prayerContainer').innerHTML = "<p>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>";
        }
    }

    // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    function renderPrayerList(timings) {
        const container = document.getElementById('prayerContainer');
        container.innerHTML = '';
        const prayersToShow = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

        prayersToShow.forEach(name => {
            const div = document.createElement('div');
            div.className = 'prayer-item';
            div.id = `row-${name}`;
            div.innerHTML = `
                <div>${prayerNamesTh[name]}</div>
                <div>${timings[name]}</div>
            `;
            container.appendChild(div);
        });
    }

    // 5. ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤
    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        document.getElementById('clock').innerText = `${hours}:${minutes}:${seconds}`;

        checkPrayerTime(`${hours}:${minutes}`, seconds);
    }

    // 6. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    function checkPrayerTime(currentTime, seconds) {
        if (seconds === '00') adhanPlayedThisMinute = false; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏´‡∏°‡πà

        for (const [name, time] of Object.entries(prayerTimes)) {
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏° (‡πÄ‡∏ä‡πà‡∏ô 12:30 == 12:30)
            if (time === currentTime) {
                // Highlight ‡∏™‡∏µ
                document.querySelectorAll('.prayer-item').forEach(el => el.classList.remove('active'));
                const activeRow = document.getElementById(`row-${name}`);
                if(activeRow) activeRow.classList.add('active');

                // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß)
                if (!adhanPlayedThisMinute && audioEnabled) {
                    playAdhan(name);
                    adhanPlayedThisMinute = true;
                }
            }
        }
    }

    function playAdhan(name) {
        audio.currentTime = 0;
        audio.play();
        statusMsg.innerHTML = `üîî ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏î <span style="font-size:1.2rem">${prayerNamesTh[name]}</span>`;
        
        // Browser Notification
        if (Notification.permission === "granted") {
            new Notification(`‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏î ${prayerNamesTh[name]}`);
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission();
        }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    fetchPrayerTimes();
    setInterval(updateClock, 1000);
    if (Notification.permission !== "denied") Notification.requestPermission();

</script>

</body>
</html>
