<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times Pro - Yala & Southern</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-dark: #064439;
            --accent-green: #1a5d52;
            --bg-soft: #f0f4f3;
            --white: #ffffff;
            --card-gray: #f8faf9;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-soft);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 430px;
            background: var(--white);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.05);
        }

        /* Top Header */
        .header {
            padding: 40px 25px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .date-box h2 { margin: 0; font-size: 1.3rem; font-weight: 600; color: #333; }
        .date-box p { margin: 0; color: #888; font-size: 0.95rem; }

        /* Next Prayer Card */
        .highlight-card {
            margin: 20px 25px;
            background: var(--white);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.04);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #f0f0f0;
        }

        .p-label { color: var(--primary-dark); font-size: 1.5rem; font-weight: 600; margin: 0; }
        .p-time { font-size: 2.5rem; font-weight: 700; color: var(--primary-dark); margin: 5px 0; }
        .p-status { color: #e53935; font-size: 0.9rem; font-weight: 500; }

        /* Prayer Grid */
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 0 25px;
            margin-top: 20px;
        }

        .prayer-item {
            background: var(--primary-dark);
            color: white;
            border-radius: 18px;
            padding: 15px 5px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(6, 68, 57, 0.15);
        }

        .prayer-item.active { background: #fff; color: var(--primary-dark); border: 2px solid var(--primary-dark); }
        .prayer-item i { font-size: 1.3rem; margin-bottom: 8px; display: block; opacity: 0.9; }
        .prayer-item .p-name { font-size: 0.85rem; font-weight: 400; display: block; }
        .prayer-item .p-val { font-size: 1rem; font-weight: 600; }

        /* Selector */
        .selector-box {
            margin: 25px;
            background: #f4f8f7;
            border-radius: 15px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            border: none; background: transparent; font-family: 'Kanit';
            font-size: 1rem; width: 100%; outline: none; color: var(--primary-dark); font-weight: 500;
        }

        /* Admin Trigger */
        .admin-trigger {
            text-align: center; color: #ddd; font-size: 0.7rem; cursor: pointer; padding: 20px;
        }

        /* Modal Settings */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2000; overflow-y: auto; padding: 25px; box-sizing: border-box;
        }

        .range-card { background: #f9f9f9; padding: 20px; border-radius: 20px; margin-bottom: 20px; border: 1px solid #eee; }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; font-family: 'Kanit'; font-size: 1rem; box-sizing: border-box; }
        .btn-prime { background: var(--primary-dark); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-prime:hover { background: var(--accent-green); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="date-box">
            <h2 id="thDate">-- --- ----</h2>
            <p id="hijriDate">-- Ramadan 1447 AH</p>
        </div>
        <div style="font-size: 1.5rem; color: var(--primary-dark);"><i class="fa-regular fa-bell"></i></div>
    </div>

    <div id="nextPrayerDisplay" class="highlight-card">
        <div>
            <p id="curName" class="p-label">Isha</p>
            <div id="curTime" class="p-time">20:39</div>
            <div id="countdown" class="p-status">เหลือเวลาอีก -- ชม. -- นาที</div>
        </div>
        <div style="font-size: 3.5rem; color: #fbc02d;"><i id="curIcon" class="fa-solid fa-moon"></i></div>
    </div>

    <div class="prayer-grid" id="prayerGrid">
        </div>

    <div class="selector-box">
        <i class="fa-solid fa-location-dot" style="color: var(--primary-dark);"></i>
        <select id="citySelect">
            <option value="ยะลา">ยะลา</option>
            <option value="นครศรีธรรมราช">นครศรีธรรมราช / พัทลุง</option>
            <option value="จะนะ">จะนะ / เทพา</option>
            <option value="สตูล">สตูล</option>
            <option value="ตรัง">ตรัง</option>
            <option value="ปัตตานี">ปัตตานี</option>
            <option value="นราธิวาส">นราธิวาส</option>
            <option value="สุไหงโกลก">สุไหงโกลก</option>
        </select>
    </div>

    <div style="text-align: center; color: #999; font-size: 0.8rem; padding: 0 40px;">ข้อมูลอ้างอิงตามตารางประกาศจังหวัดยะลา</div>
    <div class="admin-trigger" id="adminBtn">ADMIN MODE</div>
</div>

<div id="adminModal" class="modal">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <h2 style="color: var(--primary-dark);">ตั้งค่าระบบแอดมิน</h2>
        <span id="closeAdmin" style="font-size: 2rem; cursor: pointer;">&times;</span>
    </div>

    <div id="loginStep">
        <input type="password" id="passCode" placeholder="รหัสผ่าน 17851902">
        <button class="btn-prime" id="loginBtn">เข้าสู่ระบบ</button>
    </div>

    <div id="configStep" style="display:none;">
        <div class="range-card">
            <h4 style="margin-top:0;">1. ตั้งค่าช่วงวันที่ (ยะลา)</h4>
            <label>ตั้งแต่วันที่:</label>
            <input type="date" id="dateStart">
            <label>ถึงวันที่:</label>
            <input type="date" id="dateEnd">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                <div><small>Fajr</small><input type="time" id="set-fajr"></div>
                <div><small>Dhuhr</small><input type="time" id="set-dhuhr"></div>
                <div><small>Asr</small><input type="time" id="set-asr"></div>
                <div><small>Maghrib</small><input type="time" id="set-maghrib"></div>
                <div><small>Isha</small><input type="time" id="set-isha"></div>
            </div>
            <button class="btn-prime" id="saveRangeBtn">บันทึกช่วงเวลานี้</button>
        </div>

        <div class="range-card">
            <h4>2. ตั้งค่าวันแรกของรอมฎอน</h4>
            <input type="date" id="ramadanDate">
            <button class="btn-prime" id="saveRamadanBtn">อัปเดตปฏิทินอิสลาม</button>
        </div>
    </div>
</div>

<script>
    const PASS = "17851902";
    const OFFSETS = { 'ยะลา': 0, 'นครศรีธรรมราช': 3, 'จะนะ': 1, 'สตูล': 2, 'ตรัง': 4, 'ปัตตานี': -2, 'นราธิวาส': -4, 'สุไหงโกลก': -5 };
    const P_META = [
        {id:'fajr', name:'Fajr', icon:'fa-sun-haze'},
        {id:'dhuhr', name:'Dhuhr', icon:'fa-sun'},
        {id:'asr', name:'Asr', icon:'fa-cloud-sun'},
        {id:'maghrib', name:'Maghrib', icon:'fa-moon-stars'},
        {id:'isha', name:'Isha', icon:'fa-moon'}
    ];

    let db = JSON.parse(localStorage.getItem('prayerDB')) || { ranges: [], ramadanStart: "2026-03-01" };

    function init() {
        renderAll();
        // Event Listeners
        document.getElementById('adminBtn').onclick = () => document.getElementById('adminModal').style.display = 'block';
        document.getElementById('closeAdmin').onclick = () => document.getElementById('adminModal').style.display = 'none';
        document.getElementById('loginBtn').onclick = handleLogin;
        document.getElementById('saveRangeBtn').onclick = saveRange;
        document.getElementById('saveRamadanBtn').onclick = saveRamadan;
        document.getElementById('citySelect').onchange = renderAll;
        setInterval(renderAll, 60000); // อัปเดตทุกนาที
    }

    function renderAll() {
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        const city = document.getElementById('citySelect').value;
        const offset = OFFSETS[city];

        // 1. วันที่
        document.getElementById('thDate').innerText = today.toLocaleDateString('th-TH', {day:'numeric', month:'long', year:'numeric'});
        
        // 2. ปฏิทินรอมฎอน
        const rStart = new Date(db.ramadanStart);
        const diff = Math.floor((today - rStart) / (1000*60*60*24));
        document.getElementById('hijriDate').innerText = (diff >= 0 && diff < 30) ? `${diff+1} Ramadan 1447 AH` : "Rabi' al-awwal 27 - 1447 AH";

        // 3. หาเวลาละหมาดจากช่วงวันที่
        let times = db.ranges.find(r => dateStr >= r.start && dateStr <= r.end) || {fajr:"05:10", dhuhr:"12:30", asr:"15:45", maghrib:"18:35", isha:"19:45"};

        // 4. แสดงผลตาราง 4 ช่องล่าง (ตามรูปที่ 2)
        const grid = document.getElementById('prayerGrid');
        grid.innerHTML = '';
        P_META.slice(0,4).forEach(p => {
            grid.innerHTML += `<div class="prayer-item"><i class="fa-solid ${p.icon}"></i><span class="p-name">${p.name}</span><span class="p-val">${addMin(times[p.id], offset)}</span></div>`;
        });

        // 5. แสดงผลตัวบน (Next/Current)
        document.getElementById('curName').innerText = "Isha";
        document.getElementById('curTime').innerText = addMin(times.isha, offset);
    }

    function addMin(t, m) {
        let [hh, mm] = t.split(':').map(Number);
        let d = new Date(); d.setHours(hh, mm + m);
        return d.toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit', hour12:false});
    }

    function handleLogin() {
        if(document.getElementById('passCode').value === PASS) {
            document.getElementById('loginStep').style.display = 'none';
            document.getElementById('configStep').style.display = 'block';
        } else { alert("รหัสผ่านไม่ถูกต้อง"); }
    }

    function saveRange() {
        const newR = {
            start: document.getElementById('dateStart').value,
            end: document.getElementById('dateEnd').value,
            fajr: document.getElementById('set-fajr').value,
            dhuhr: document.getElementById('set-dhuhr').value,
            asr: document.getElementById('set-asr').value,
            maghrib: document.getElementById('set-maghrib').value,
            isha: document.getElementById('set-isha').value
        };
        db.ranges.push(newR);
        localStorage.setItem('prayerDB', JSON.stringify(db));
        alert("บันทึกสำเร็จ!");
        renderAll();
    }

    function saveRamadan() {
        db.ramadanStart = document.getElementById('ramadanDate').value;
        localStorage.setItem('prayerDB', JSON.stringify(db));
        alert("อัปเดตปฏิทินรอมฎอนแล้ว");
        renderAll();
    }

    window.onload = init;
</script>
</body>
</html>
