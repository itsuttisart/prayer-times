<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times Pro - Modern UI</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary-green: #064439;
            --light-green: #e8f5e9;
            --accent-green: #2e7d32;
            --text-gray: #757575;
            --white: #ffffff;
            --card-shadow: 0 8px 24px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--primary-green);
        }

        .phone-container {
            width: 100%;
            max-width: 414px; /* iPhone size */
            background: #fdfdfd;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        /* Top Header */
        .app-header {
            padding: 30px 20px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .date-info h2 { margin: 0; font-size: 1.2rem; font-weight: 600; }
        .date-info p { margin: 0; color: var(--text-gray); font-size: 0.9rem; }

        /* Next Prayer Card (Big Card) */
        .next-prayer-card {
            margin: 20px;
            background: var(--white);
            border-radius: 24px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #f0f0f0;
        }

        .next-info h3 { margin: 0; font-size: 1.5rem; color: var(--primary-green); }
        .next-info .time { font-size: 2.2rem; font-weight: bold; margin: 5px 0; }
        .next-info .countdown { color: #d32f2f; font-size: 0.9rem; font-weight: 500; }

        .next-icon { font-size: 3rem; color: #fbc02d; opacity: 0.8; }

        /* Prayer Grid */
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 0 20px;
            margin-bottom: 25px;
        }

        .grid-item {
            background: var(--primary-green);
            color: white;
            border-radius: 16px;
            padding: 15px 5px;
            text-align: center;
            transition: 0.3s;
        }

        .grid-item.active { background: var(--white); color: var(--primary-green); box-shadow: var(--card-shadow); border: 1px solid #eee; }
        .grid-item i { font-size: 1.2rem; margin-bottom: 8px; display: block; }
        .grid-item .name { font-size: 0.85rem; font-weight: 300; display: block; }
        .grid-item .time { font-size: 0.95rem; font-weight: 600; }

        /* City Selector */
        .city-selector {
            margin: 0 20px 20px;
            background: var(--light-green);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            border: none; background: transparent; font-family: 'Kanit';
            font-size: 1rem; width: 100%; outline: none; color: var(--primary-green); font-weight: 500;
        }

        /* Footer Message */
        .footer-msg { text-align: center; font-size: 0.8rem; color: var(--text-gray); padding: 20px; }

        /* Admin Overlay */
        .overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 1000; overflow-y: auto; padding: 30px 20px; box-sizing: border-box;
        }

        .admin-section { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .admin-section h3 { color: var(--primary-green); border-left: 4px solid var(--accent-green); padding-left: 10px; }

        .range-box { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        input, button { 
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; 
            border: 1px solid #ddd; font-family: 'Kanit'; box-sizing: border-box;
        }
        button.btn-save { background: var(--primary-green); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .admin-trigger { position: absolute; bottom: 10px; right: 10px; font-size: 0.6rem; color: #ddd; cursor: pointer; }
    </style>
</head>
<body>

<div class="phone-container">
    <div class="app-header">
        <div class="date-info">
            <h2 id="thDate">22 กุมภาพันธ์ 2569</h2>
            <p id="hijriDisplay">Rabi' al-awwal 27 - 1447 AH</p>
        </div>
        <div style="font-size: 1.5rem;"><i class="fa-regular fa-bell"></i></div>
    </div>

    <div class="next-prayer-card">
        <div class="next-info">
            <h3 id="nextName">Isha</h3>
            <div class="time" id="nextTime">20:39</div>
            <div class="countdown" id="countdown">เหลือเวลาอีก 2 ชม. 13 นาที</div>
        </div>
        <div class="next-icon">
            <i id="nextIconClass" class="fa-solid fa-moon"></i>
        </div>
    </div>

    <div class="prayer-grid" id="prayerGrid">
        </div>

    <div class="city-selector">
        <i class="fa-solid fa-location-dot"></i>
        <select id="citySelect" onchange="updateView()">
            <option value="ยะลา">ยะลา</option>
            <option value="นครศรีธรรมราช">นครศรีธรรมราช / พัทลุง</option>
            <option value="จะนะ">จะนะ / เทพา</option>
            <option value="สตูล">สตูล</option>
            <option value="ตรัง">ตรัง</option>
            <option value="ปัตตานี">ปัตตานี</option>
            <option value="นราธิวาส">นราธิวาส</option>
            <option value="สุไหงโกลก">สุไหงโกลก</option>
        </select>
    </div>

    <div class="footer-msg" id="footerMsg">ข้อมูลอ้างอิงตามตารางประกาศจังหวัดยะลา</div>
    
    <div class="admin-trigger" onclick="openLogin()">ADMIN MODE</div>
</div>

<div id="adminModal" class="overlay">
    <div style="display:flex; justify-content: space-between;">
        <h2>ตั้งค่าระบบแอดมิน</h2>
        <button onclick="closeAdmin()" style="width:auto; background:none; border:none; font-size:1.5rem;">&times;</button>
    </div>

    <div id="loginArea">
        <input type="password" id="passInput" placeholder="กรอกรหัสผ่าน 17851902">
        <button class="btn-save" onclick="checkAuth()">เข้าสู่ระบบ</button>
    </div>

    <div id="settingsArea" style="display:none;">
        <div class="admin-section">
            <h3>1. ตั้งค่าช่วงวันที่ (ยะลา)</h3>
            <div class="range-box">
                <label>จากวันที่:</label>
                <input type="date" id="startDate">
                <label>ถึงวันที่:</label>
                <input type="date" id="endDate">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="time" id="set-fajr" step="60">
                    <input type="time" id="set-dhuhr" step="60">
                    <input type="time" id="set-asr" step="60">
                    <input type="time" id="set-maghrib" step="60">
                    <input type="time" id="set-isha" step="60">
                </div>
                <button class="btn-save" onclick="saveDateRange()">บันทึกช่วงวันที่นี้</button>
            </div>
            <p style="font-size:0.8rem; color:red;">* ระบบจะจำเวลาตามช่วงวันที่คุณตั้ง</p>
        </div>

        <div class="admin-section">
            <h3>2. ตั้งค่าปฏิทินรอมฎอน</h3>
            <div class="range-box">
                <label>วันที่ 1 Ramadan ตรงกับวันที่สากล:</label>
                <input type="date" id="ramadanStartDate">
                <button class="btn-save" onclick="saveRamadanDate()">อัปเดตปฏิทินฮิจเราะห์</button>
            </div>
        </div>
    </div>
</div>

<script>
    const SECRET = "17851902";
    
    // โครงสร้างข้อมูลแบบช่วงวันที่
    let prayerData = JSON.parse(localStorage.getItem('prayerDateRanges')) || [];
    let ramadanStart = localStorage.getItem('ramadanStart') || "2026-03-01";

    const offsets = {
        'ยะลา': 0, 'นครศรีธรรมราช': 3, 'จะนะ': 1, 'สตูล': 2, 'ตรัง': 4, 'ปัตตานี': -2, 'นราธิวาส': -4, 'สุไหงโกลก': -5
    };

    const prayerMeta = [
        { id: 'fajr', name: 'Fajr', ar: 'فجر', icon: 'fa-sun-rising' },
        { id: 'dhuhr', name: 'Dhuhr', ar: 'ظهر', icon: 'fa-sun' },
        { id: 'asr', name: 'Asr', ar: 'عصر', icon: 'fa-cloud-sun' },
        { id: 'maghrib', name: 'Maghrib', ar: 'مغرب', icon: 'fa-moon' },
        { id: 'isha', name: 'Isha', ar: 'عشاء', icon: 'fa-star' }
    ];

    function updateView() {
        const todayStr = new Date().toISOString().split('T')[0];
        const city = document.getElementById('citySelect').value;
        const offset = offsets[city];

        // หาข้อมูลเวลาตามช่วงวันที่
        let currentTimes = prayerData.find(range => todayStr >= range.start && todayStr <= range.end);
        
        // ถ้าไม่พบช่วงวันที่ ให้ใช้ค่า Default
        if (!currentTimes) {
            currentTimes = { fajr: "05:08", dhuhr: "12:30", asr: "15:45", maghrib: "18:35", isha: "19:45" };
        }

        renderGrid(currentTimes, offset);
        updateHijri();
        updateNextPrayer(currentTimes, offset);
    }

    function renderGrid(times, offset) {
        const grid = document.getElementById('prayerGrid');
        grid.innerHTML = '';
        prayerMeta.forEach(p => {
            const finalTime = addMins(times[p.id], offset);
            grid.innerHTML += `
                <div class="grid-item">
                    <i class="fa-solid ${p.icon}"></i>
                    <span class="name">${p.name}</span>
                    <span class="time">${finalTime}</span>
                </div>
            `;
        });
    }

    function addMins(timeStr, mins) {
        let [h, m] = timeStr.split(':').map(Number);
        let d = new Date(); d.setHours(h, m + mins, 0);
        return d.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', hour12: false });
    }

    // คำนวณวันฮิจเราะห์แบบ Dynamic
    function updateHijri() {
        const today = new Date();
        const ramadan = new Date(ramadanStart);
        const diffTime = today - ramadan;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        let hijriText = "";
        if (diffDays >= 0 && diffDays < 30) {
            hijriText = `${diffDays + 1} Ramadan 1447 AH`;
        } else {
            hijriText = "Rabi' al-awwal 27 - 1447 AH (Auto)";
        }
        document.getElementById('hijriDisplay').innerText = hijriText;
    }

    function updateNextPrayer(times, offset) {
        // ตรรกะหาละหมาดถัดไป (สั้นๆ)
        document.getElementById('nextName').innerText = "Maghrib";
        document.getElementById('nextTime').innerText = addMins(times.maghrib, offset);
    }

    // Admin Logic
    function openLogin() { document.getElementById('adminModal').style.display = 'block'; }
    function closeAdmin() { document.getElementById('adminModal').style.display = 'none'; }
    
    function checkAuth() {
        if(document.getElementById('passInput').value === SECRET) {
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('settingsArea').style.display = 'block';
        } else { alert("รหัสผ่านไม่ถูกต้อง"); }
    }

    function saveDateRange() {
        const range = {
            start: document.getElementById('startDate').value,
            end: document.getElementById('endDate').value,
            fajr: document.getElementById('set-fajr').value,
            dhuhr: document.getElementById('set-dhuhr').value,
            asr: document.getElementById('set-asr').value,
            maghrib: document.getElementById('set-maghrib').value,
            isha: document.getElementById('set-isha').value
        };
        prayerData.push(range);
        localStorage.setItem('prayerDateRanges', JSON.stringify(prayerData));
        alert("บันทึกช่วงวันที่เรียบร้อยแล้ว!");
        updateView();
    }

    function saveRamadanDate() {
        ramadanStart = document.getElementById('ramadanStartDate').value;
        localStorage.setItem('ramadanStart', ramadanStart);
        alert("อัปเดตวันเริ่มต้นรอมฎอนแล้ว");
        updateView();
    }

    setInterval(() => {
        const now = new Date();
        document.getElementById('thClock')?.innerText = now.toLocaleTimeString('th-TH');
    }, 1000);

    updateView();
</script>
</body>
</html>
